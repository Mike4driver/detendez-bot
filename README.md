# DetendezBot ü§ñ

A comprehensive multi-functional Discord bot that combines leveling systems, starboard functionality, music playback, birthday tracking, AI-powered daily content, and interactive AI chat. Built with Python and discord.py.

## ‚ú® Features

### üìä Leveling System
- **XP Tracking**: Users earn XP by sending messages with customizable amounts and cooldowns
- **Leaderboards**: Server-specific rankings with detailed statistics
- **Level-up Notifications**: Automatic announcements when users reach new levels
- **Admin Controls**: Manually adjust user levels and XP
- **Configurable**: Set XP amounts, cooldowns, excluded channels, and notification channels

### ‚≠ê Starboard
- **Message Highlighting**: Automatically feature messages that receive enough star reactions
- **Dynamic Updates**: Star counts update in real-time as reactions change
- **Customizable**: Configure star emoji, threshold, and starboard channel
- **Smart Features**: Prevents self-starring, handles message deletions, and removes messages below threshold
- **Manual Starring**: Use `/star` command to manually star messages

### üéµ Music Bot
- **YouTube Integration**: Play music from YouTube URLs or search queries
- **Queue Management**: Add, remove, and view songs in the queue
- **Playback Controls**: Play, pause, resume, skip, stop, and volume control
- **Auto-management**: Automatic queue progression and inactivity disconnection
- **Cookie Support**: Advanced YouTube access with cookie management for better reliability

### üéÇ Birthday System
- **Birthday Tracking**: Users can set their birthdays with flexible date formats
- **Daily Announcements**: Automatic birthday celebrations in designated channels
- **Optional Role Assignment**: Temporary birthday roles for celebrating users
- **Birthday Lists**: View upcoming birthdays by month or all birthdays chronologically

### üß† AI-Powered Content
- **Daily Facts**: Interesting facts generated by Gemini AI with fallback content
- **Daily Questions**: Thought-provoking discussion questions to engage communities
- **Interactive AI Chat**: Direct conversation with AI using the `/ask` command
- **Smart Scheduling**: Configurable posting times (Facts: 9 AM default, Questions: 3 PM default)
- **Repetition Avoidance**: Tracks recent content to maintain variety

### üé§ Text-to-Speech
- **ElevenLabs Integration**: High-quality AI voice synthesis
- **Multiple Voices**: Access to various realistic AI voices
- **Customizable Settings**: Adjust speed, stability, and clarity
- **Voice Management**: List and select from available voices
- **Admin Controls**: Configure TTS settings and limits

### ‚öôÔ∏è Comprehensive Configuration
- **Per-server Settings**: All features are configurable per Discord server
- **Admin Controls**: Extensive configuration options for server administrators
- **Permission Management**: Proper permission checks for all admin features
- **Database Persistence**: All data stored in SQLite with proper cleanup

## üöÄ Quick Start

### Prerequisites
- Python 3.8 or higher
- Discord Bot Token
- (Optional) Google Gemini API Key for AI features
- (Optional) ElevenLabs API Key for text-to-speech features
- (Optional) YouTube cookies file for enhanced music access

### Installation

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd detendezbot
   ```

2. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

3. **Set up environment variables**
   Create a `.env` file in the project root:
   ```env
   DISCORD_TOKEN=your_discord_bot_token_here
   GEMINI_API_KEY=your_gemini_api_key_here
   ELEVENLABS_API_KEY=your_elevenlabs_api_key_here
   LOG_LEVEL=INFO
   ```

4. **Run the bot**
   ```bash
   python main.py
   ```

### Discord Bot Setup

1. **Create a Discord Application**
   - Go to [Discord Developer Portal](https://discord.com/developers/applications)
   - Click "New Application" and give it a name
   - Go to the "Bot" section and click "Add Bot"
   - Copy the bot token for your `.env` file

2. **Set Bot Permissions**
   - In the "OAuth2" ‚Üí "URL Generator" section
   - Select "bot" and "applications.commands" scopes
   - Select these permissions:
     - Send Messages
     - Read Message History
     - Add Reactions
     - Use Slash Commands
     - Connect (for music)
     - Speak (for music)
     - Manage Roles (for birthday roles)
     - Embed Links
     - Attach Files

3. **Invite Bot to Server**
   - Use the generated URL to invite the bot to your server
   - Make sure you have "Manage Server" permission

### Optional: Gemini AI Setup

1. **Get API Key**
   - Go to [Google AI Studio](https://makersuite.google.com/app/apikey)
   - Create a new API key
   - Add it to your `.env` file as `GEMINI_API_KEY`

2. **Note**: Without the Gemini API key, the bot will use fallback content for facts and questions, and the `/ask` command will be disabled.

### Optional: ElevenLabs TTS Setup

1. **Get API Key**
   - Go to [ElevenLabs](https://elevenlabs.io/api)
   - Create an account and get your API key
   - Add it to your `.env` file as `ELEVENLABS_API_KEY`

2. **Note**: Without the ElevenLabs API key, text-to-speech commands will be disabled.

## üìñ Usage Guide

### Basic Commands

#### User Commands
- `/help` - Show comprehensive help information
- `/rank [user]` - Check rank and level
- `/leaderboard [limit]` - View server leaderboard
- `/play <query>` - Play music from YouTube
- `/queue` - Show the current music queue
- `/skip` - Skip the current song
- `/stop` - Stop music and clear queue
- `/pause` - Pause the current song
- `/resume` - Resume the paused song
- `/volume <level>` - Set playback volume (0-100)
- `/nowplaying` (or `/np`) - Show currently playing song
- `/remove <position>` - Remove a song from the queue
- `/fact` - Get a random fun fact
- `/question` - Get a discussion question
- `/ask <question>` - Ask the AI any question directly
- `/tts <text>` - Generate text-to-speech audio
- `/voices` - List available TTS voices
- `/setbirthday <date>` - Set your birthday
- `/birthday [user]` - View someone's birthday
- `/birthdays [month]` - List upcoming birthdays
- `/removebirthday` - Remove your birthday
- `/allbirthdays` - Show all birthdays in chronological order
- `/star <message_id>` - Manually star a message

#### Admin Commands (Require Administrator permission)
- `/leveling-config` - Configure XP system
- `/setlevel <user> <level>` - Set a user's level
- `/addxp <user> <amount>` - Add XP to a user
- `/removexp <user> <amount>` - Remove XP from a user
- `/resetxp [user]` - Reset XP for a user or all users
- `/starboard [channel] [threshold] [emoji]` - Quick starboard setup
- `/starboard-config` - Configure starboard settings
- `/birthday-config` - Configure birthday system
- `/fact-config` - Configure daily facts
- `/question-config` - Configure daily questions  
- `/tts-config` - Configure text-to-speech settings
- `/set_cookies` - Set YouTube cookies for better music access
- `/refresh_cookies` - Refresh YouTube cookies (for music)
- `/cookie_status` - Check cookie status

### Configuration Examples

#### Setting up Leveling
```
/leveling-config xp_per_message:20 cooldown:30 level_up_channel:#level-ups
```

#### Setting up Starboard
```
/starboard-config channel:#starboard threshold:5 emoji:‚≠ê
```

#### Setting up Birthday System
```
/birthday-config channel:#birthdays role:@Birthday time:00:00
```

#### Setting up Facts and Questions
```
/fact-config channel:#daily-facts time:09:00
/question-config channel:#daily-questions time:15:00
```

#### Setting up Text-to-Speech
```
/tts-config max_length:1000 default_voice:Rachel
```

#### Setting up YouTube Cookies (for better music access)
```
/set_cookies cookies:<paste your cookies here>
```
Or upload a cookies file:
```
/set_cookies attachment:<cookies.txt file>
```

## üõ†Ô∏è Development

### Project Structure
```
detendezbot/
‚îú‚îÄ‚îÄ main.py              # Bot entry point
‚îú‚îÄ‚îÄ config.py            # Configuration management
‚îú‚îÄ‚îÄ database.py          # Database operations
‚îú‚îÄ‚îÄ requirements.txt     # Python dependencies
‚îú‚îÄ‚îÄ cogs/               # Feature modules
‚îÇ   ‚îú‚îÄ‚îÄ leveling.py     # XP and leveling system
‚îÇ   ‚îú‚îÄ‚îÄ starboard.py    # Starboard functionality
‚îÇ   ‚îú‚îÄ‚îÄ music.py        # Music bot features
‚îÇ   ‚îú‚îÄ‚îÄ birthday.py     # Birthday tracking
‚îÇ   ‚îú‚îÄ‚îÄ facts.py        # Daily facts system
‚îÇ   ‚îú‚îÄ‚îÄ questions.py    # Daily questions system
‚îÇ   ‚îú‚îÄ‚îÄ ai.py           # Interactive AI chat
‚îÇ   ‚îú‚îÄ‚îÄ tts.py          # Text-to-speech features
‚îÇ   ‚îî‚îÄ‚îÄ help.py         # Help system
‚îî‚îÄ‚îÄ README.md           # This file
```

### Database Schema
The bot uses SQLite with the following main tables:
- `user_levels` - XP and level data
- `starboard_messages` - Starboard message tracking
- `user_birthdays` - Birthday information
- `guild_config` - Per-server configuration settings
- `recent_content` - Recent facts/questions tracking to avoid repetition
- `music_queue` - Music queue persistence (optional)

### Adding New Features
1. Create a new cog file in the `cogs/` directory
2. Follow the existing pattern for database operations
3. Add proper error handling and logging
4. Update the help system with new commands
5. Add the cog to the loading list in `main.py`

## üîß Configuration Options

### Environment Variables
- `DISCORD_TOKEN` - Discord bot token (required)
- `GEMINI_API_KEY` - Google Gemini API key (optional, enables AI features)
- `ELEVENLABS_API_KEY` - ElevenLabs API key (optional, enables TTS features)
- `LOG_LEVEL` - Logging level (INFO, DEBUG, WARNING, ERROR)

### Per-Server Settings
All features can be configured per Discord server through admin commands:

- **Leveling**: XP amounts, cooldowns, excluded channels, notification channels
- **Starboard**: Channel, emoji, threshold
- **Birthday**: Announcement channel, birthday role, birthday time
- **Facts**: Channel and posting time
- **Questions**: Channel and posting time
- **TTS**: Maximum text length, default voice

## üêõ Troubleshooting

### Common Issues

1. **Bot not responding to commands**
   - Check if bot has proper permissions
   - Verify bot token is correct
   - Check if commands are synced (restart bot)

2. **Music not working**
   - Ensure bot has voice permissions (Connect and Speak)
   - Check if you're in a voice channel
   - Verify yt-dlp is properly installed and up to date
   - Use `/set_cookies` to add YouTube cookies for better access
   - Try `/refresh_cookies` if YouTube playback fails
   - Check `/cookie_status` for cookie file status

3. **AI features not working**
   - Check if Gemini API key is set in `.env` file
   - Verify API key is valid and has proper permissions
   - Check API quota limits in Google AI Studio
   - Bot will fall back to curated content for facts/questions if AI is unavailable
   - `/ask` command will be disabled without API key

4. **TTS not working**
   - Check if ElevenLabs API key is set in `.env` file
   - Verify API key is valid and has quota available
   - Check ElevenLabs dashboard for usage limits
   - `/tts` and `/voices` commands will be disabled without API key

5. **Database errors**
   - Ensure write permissions in bot directory
   - Check SQLite installation
   - Restart bot to reinitialize database

### Logging
The bot logs to both console and `bot.log` file. Check logs for detailed error information.

## üìù License

This project is open source. Feel free to modify and distribute according to your needs.

## ü§ù Contributing

Contributions are welcome! Please feel free to submit pull requests or open issues for bugs and feature requests.

## üìû Support

For support, questions, or feature requests, please open an issue on the repository.

---

**Note**: This bot requires proper Discord permissions and optional API keys for full functionality. Make sure to review Discord's Terms of Service and API usage guidelines when deploying. 